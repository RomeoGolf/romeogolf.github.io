<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USB-polygon-2: Схема и плата</title>
  <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="http://romeogolf.github.io/theme/css/styles.css" type="text/css" />
  <link rel="stylesheet" type="text/css"  href="http://romeogolf.github.io/theme/css/pygments.css"/>
  <link rel="shortcut icon" type="image/png" href="http://romeogolf.github.io/images/RG32.ico" />
  <script language="JavaScript" src="http://romeogolf.github.io/theme/js/protector.js"></script>
</head>
<body>
  <header class="main-header">
    <div>
      <img src="http://romeogolf.github.io/images/72.png" style="margin-left: 34px; margin-top: 30px;"> <a id="name" href=http://romeogolf.github.io id="home-link">RomeoGolf</a>
    </div>
  </header>
    <nav class="nav_base">
      <ul class="main-nav">
          <li class="active"><a href="http://romeogolf.github.io/category/blog.html">Блог</a></li>
          <li><a href="http://romeogolf.github.io/category/tvorchestvo.html">Творчество</a></li>


          <li>
            <a href="http://romeogolf.github.io/pages/triangulum-soft.html">Triangulum Soft</a>
          </li>
          <li>
            <a href="http://romeogolf.github.io/pages/o-saite.html">О сайте</a>
          </li>
      </ul>
    </nav>
  <div class="layout">

    <div class="sidebar">
      <div class="tagcloud">
        Теги:
        <ul class="tagcloud">
          <li class="tag-4">
            <a href="http://romeogolf.github.io/tag/batcmd.html">
              bat/cmd
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/linux.html">
              linux
                <span class="badge">3</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/markdown.html">
              markdown
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-1">
            <a href="http://romeogolf.github.io/tag/pelican.html">
              pelican
                <span class="badge">6</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/rfquiz.html">
              rfquiz
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="http://romeogolf.github.io/tag/tar.html">
              tar
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/triangulum.html">
              triangulum
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-1">
            <a href="http://romeogolf.github.io/tag/usb-polygon.html">
              usb-polygon
                <span class="badge">7</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/windows.html">
              windows
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/raznoe.html">
              разное
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/remont.html">
              ремонт
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/svoimi-rukami.html">
              своими руками
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/stikhi.html">
              стихи
                <span class="badge">3</span>
            </a>
          </li>
        </ul>
      </div> <!-- tagcloud -->
    </div> <!-- sidebar -->

    <div class="content">
  <section class="main-section blog-section" id="blog-posts">
    <h4 class="date">Пт 12 Август 2016</h4>
    <article>
      <h1>USB-polygon-2: Схема и плата</h1>
      
      <div class="toc">
<ul>
<li><a href="#_1">По амбарам, по сусекам&hellip;</a></li>
<li><a href="#_2">Начинаю рисовать</a></li>
<li><a href="#_3">Разводка</a></li>
<li><a href="#_4">Изготовление</a></li>
<li><a href="#_5">Заключение</a></li>
</ul>
</div>
<h2 id="_1">По амбарам, по сусекам&hellip;</h2>
<p>С элементной базой более-менее определился. Самое главное &mdash; контроллер &mdash; заказан AT90USB162 на AliExpress. Заодно там же заказан дешевенький энкодер &mdash; побаловаться, но это потом. Штырьки для джамперов и сами перемычки сняты со старых материнских плат и прочей компьютерной техники. Кнопки от мышей, шнур USB &mdash; тоже. Первоначально планировалось шнур к плате просто припаять, однако в запасах нашелся разъемчик mini-USB на плату, а также универсальный переходник для зарядки разного рода гаджетов, от которого был отрезан и разобран ответный разъем на кабель. Светодиоды тоже есть, снятые с каких-то плат, уже и не помню, откуда. &laquo;Рассыпуху&raquo; &mdash; резисторы и конденсаторы &mdash; решил брать для поверхностного монтажа, чтобы уменьшить размеры платы и поменьше сверлить. Эта мелочь тоже в основном демонтирована с других плат, материнских, винчестерных, флопповодных и прочего, только на 22 Ома пришлось искать. Среди горсти имеющихся кварцев нашелся и на 8 МГц, что радует, ибо пробежка по форумам показала, что с другими (кроме 8 и 16) есть проблемы при попытках программировать через FLIP.</p>
<p>Стал выбирать инструмент для рисования и разводки схемы и платы. Перебрал несколько вариантов. Вообще-то, можно настолько простую схему нарисовать и карандашом, а плату вообще в чем угодно, от Sprint Layout до любого векторного редактора, но если уж задача учебная &mdash; будем делать вид, что все по-взрослому, как бы серьезный проект. Поэтому хотелось бы выбрать что-то доступное, кроссплатформенное и достаточно серьезное с учетом возможных будущих действительно серьезных проектов.</p>
<p>Остановился в конце концов на KiCAD. Он кроссплатформенный вполне, в чем я убедился, работая над проектом попеременно то в Windows XP, то в Windows 7, то в Debian Linux. Его возможностей за глаза достаточно для любительских целей. В нем можно и рисовать схему, и разводить плату. При разводке платы он проверяет правильность соединений и неподключенные контакты. И, наконец, он GNU GPL &mdash; бери и пользуйся.</p>
<h2 id="_2">Начинаю рисовать</h2>
<p>Питание развел в соответствии с атмеловским <a href="http://www.atmel.com/ru/ru/Images/doc7707.pdf" title="Описание на AT90USB">описанием</a> на контроллер, скомбинировав рисунки 7-1 и 7-2, поставил в нужном месте переключатель. То есть, беру +5 В от USB и, в зависимости от положения переключателя, либо питаю кристалл прямо от +5, либо подаю на встроенный преобразователь напряжения и питаю кристалл от +3,3 В. При рисовании схемы предусмотрел контакты для внешних устройств: +5 В, +3,3 В, текущее питание кристалла (в зависимости от положения переключателя) и корпус (хотя, по идее, корпус можно и так много откуда взять). Между +5 В и корпусом поставил традиционные две емкости, побольше и поменьше, а заодно воткнул светодиод для индикации подключенности питания, через токоограничивающий резистор, конечно.</p>
<p>Кварц тоже воткнул в соответствии с официальной документацией, по рисунку 6-4. Конденсаторы нашел, кажется, на 20 пик. Кварц хотел взять на 12 МГц, один из заказанных в Китае, оставшихся от ремонта флэшки. Но, похоже, лучше всего будет поставить 8 МГц, чтобы избежать неприятностей при &laquo;прошивке&raquo; по USB.</p>
<p>Подключил разъем mini-USB. Изначально хотел вывести просто контактные площадки, чтоб было куда подпаять шнурок, но подумал, что подпаять можно будет и к контактам, предусмотренным для разъема, а разъем (если вдруг захочется) на абы какие площадки не встанет.</p>
<p>Нарисовал кнопку Reset, подтянутую к напряжению питания. Не к +5, что важно, а именно к текущему питанию, в зависимости от тумблера режима питания.</p>
<p>Аналогичным образом подключил кнопку HWB, которая нужна для переключения контроллера в режим &laquo;прошивки&raquo; по USB. Но потом пришлось добавить еще один тумблер, переключающий направление с этого вывода к кнопке и к светодиоду. Так уж получилось, что HWB является одной из альтернативных функций порта D, а я хотел бы иметь возможность использовать весь этот порт, все восемь разрядов. На них я посадил по светодиоду (через токоограничивающие резисторы, конечно), анодом к порту, катодом на корпус. То есть, зажигаться они будут логической &laquo;1&raquo;. Линию, соединяющую резисторы этих светодиодов, я провел не прямо на корпус, а через джампер, чтобы иметь возможность отключить их оптом. Например, для того, чтобы попользоваться портом в других целях: каждая нитка порта идет не только на свой светодиод, но и на контактную площадку. Таким образом, можно к порту подпаять что-то внешнее, может, на ввод (типа энкодера), а может, и на вывод (типа экранчика).</p>
<p>Порт B вывел на контактные площадки напрямую, без выкрутасов.</p>
<p>Порт C не вполне полноценный. Разряд 1 занят на Reset, и играться с ним, переключая тумблером назначение, не хотелось бы. Разряд 0 занят на кварц, тут вообще не поиграешься. Разряд 3 вообще отсутствует напрочь. Остается пять штук. Решил посадить их на кнопки, с которыми можно будет поиграться разными методами &mdash; опросом в цикле, обработкой прерываний, защитой от дребезга разными программными способами&hellip; Каждая кнопка подтянута на питание, каждая нитка к кнопке идет через джампер, и каждая линия порта идет дополнительно на контактную площадку (для чего и джамперы).</p>
<p>Кнопки сразу нарисовал трехконтактные, потому что при разводке буду учитывать мышиные. Незадействованный контакт отметил, чтобы не было ошибок при проверке разводки. </p>
<p>Резисторы для &laquo;подтяжки&raquo; кнопок указал по 10 кОм, а токоограничивающие для светодиодов &mdash; по 330 Ом, посчитав, что этого должно хватить. При расчете, правда, я предположил, что ток диодов не более 20 мА, то есть, даже при питании от +5 хватит с запасом. Но потом подкорректировал: на индикацию данных поставил резисторы по 270 Ом, а на индикатор питания, где стоит другой светодиод, увеличил уже до 2 кОм, и все равно слишком ярко.</p>
<p><a href="http://romeogolf.github.io/images/usb-polygon/02/shema.png" title="Схема"><img alt="Схема в KiCAD" src="http://romeogolf.github.io/images/usb-polygon/02/preview/shema-medium.png" title="Схема" /></a></p>
<p>Вот, собственно, и все с рисованием. </p>
<h2 id="_3">Разводка</h2>
<p>Для нормальной разводки сначала надо сформировать список цепей, а потом поставить в соответствие каждому элементу его посадочную площадку. Проще всего было с контроллером &mdash; его площадка подцепилась сразу сама.</p>
<p>У разъема mini-USB площадка нашлась в библиотеке, но у нее, нехорошей такой, псевдовывод (пластмассовая &laquo;нога&raquo;) для позиционирования на плате оказался подключен к цепи (не помню уже, к какой) и выдавал ошибку при проверке правильности соединений. Пришлось править и пересохранять в специально сделанной для проекта библиотеке.</p>
<p>Для джамперов посадочные площадки нашлись в одной из стандартных библиотек. Для конденсаторов и резисторов подобрал площадки, исходя из размера элементов, но (как потом оказалось) промахнулся с двадцатипиковыми емкостями кварца &mdash; встали &laquo;внатяг&raquo;, оказались маловаты. Для контактных площадок под предполагаемую подпайку внешних штучек вполне подошли квадратные 1PIN_SMD. Для найденных среди барахла переключателей и мышиных кнопок места пришлось рисовать самостоятельно.</p>
<p>Дальше сама разводка. Начал &laquo;танцевать&raquo; от контроллера, расставлять элементы более-менее компактно, но так, чтобы светодиоды в ряд, контактные площадки портов в ряд, кнопки в ряд. </p>
<p>В один слой компактно не получалось, хоть и хотелось. Особенно неприятно, что у контроллера несколько выводов питания. С учетом того, что питание и корпус надо тянуть от разъема USB, да еще и вывести на контактные площадки, линии питания и корпуса в любом случае пересекаются. А двустороннюю плату в домашних условиях на коленке изготавливать куда сложнее, чем придумывать. В общем, сделал вторую сторону &mdash; корпус. Так можно зазоры для участков, которые не надо на корпус подключать (типа ног кнопок и светодиодов) можно сделать достаточно большими, чтобы не бояться промахнуться при совмещении слоев. Переход для соединения сторон предусмотрел перемычечного типа &mdash; тупо проволочкой.</p>
<p>В конце концов получились переходные отверстия примерно так &mdash; рядом с кварцем, вид со стороны, на которой контроллер, и со стороны, на которой кварц (&laquo;земляной&raquo; полигон):</p>
<p><img alt="Переходное отверстие" src="http://romeogolf.github.io/images/usb-polygon/02/cpu-jmp.jpg" title="Переходное отверстие" />
<img alt="Переходное отверстие" src="http://romeogolf.github.io/images/usb-polygon/02/led-jmp.jpg" title="Переходное отверстие" /></p>
<p>В итоге получилась плата 7,5х10 см. Дальше &mdash; лазерно-утюжная технология, естественно. Для разовой работы оптимальный вариант, особенно при желании сильно ужаться по бюджету. И тут, после перевода печати утюгом на плату, оказалось, что разводку придется еще подправить. Во-первых, с проводниками шириной в четверть миллиметра я погорячился, лучше все-таки сделать их полумиллиметровыми, благо, возможность такая есть. То есть, не то, чтобы они где-то непропечатались или непротравились, но как-то хиленько смотрятся, есть опасения насчет их надежности. Во-вторых, ноги мышиных кнопок толстенные, а отверстия в площадках сделаны по образцу других элементов, и при сверлении вручную китайским типа дремелем практически невозможно не порвать ободок меди, который должен остаться вокруг ноги. А какие не порвались, те выглядели настолько хлипко, что было понятно &mdash; прогрева, достаточного для толстой ноги кнопки, они уже не вынесут. </p>
<p><a href="http://romeogolf.github.io/images/usb-polygon/02/face-cad.png" title="Плата"><img alt="Плата в KiCAD" src="http://romeogolf.github.io/images/usb-polygon/02/preview/face-cad-small.png" title="Плата" /></a></p>
<p>Переделал все контактные площадки, предназначенные для сверления &mdash; переходные отверстия между сторонами, светодиоды, переключатели, мышиные кнопки, джамперы &mdash; увеличил по максимуму, до 3 мм где возможно, или, хотя бы, до 2 у джамперов. Утолщил дорожки. Перекомпоновал чуть компактнее.</p>
<h2 id="_4">Изготовление</h2>
<p>Снова дружба утюга с лазером. Распечатал обе стороны платы на листе А4 фотопринтерной бумаги Lomond глянцевой тонкой. На рисунке печать не зеркальная для наглядности, на бумаге печатал-то конечно же в зеркальном виде.</p>
<p><a href="http://romeogolf.github.io/images/usb-polygon/02/face-print.png" title="Печать, лицевая сторона"><img alt="Печать лицевая" src="http://romeogolf.github.io/images/usb-polygon/02/preview/face-print-small.png" title="Печать, лицевая сторона" /></a>
<a href="http://romeogolf.github.io/images/usb-polygon/02/back-print.png" title="Печать, задняя сторона "><img alt="Печать задняя" src="http://romeogolf.github.io/images/usb-polygon/02/preview/back-print-small.png" title="Печать, задняя сторона" /></a></p>
<p>Влезло на лист по два варианта обеих сторон платы, на случай, если плохо переведется и придется стирать рисунок ацетоном и переводить заново. Однако перевелось хорошо с первого раза. Ну, не отлично, но хорошо. Пришлось пару дорожек на самом краю подремонтировать лаком для ногтей при помощи зубочистки. На этом месте дорожка после протравки стала пошире и неровная.</p>
<p><img alt="Подкрашенная дорожка" src="http://romeogolf.github.io/images/usb-polygon/02/circuit1.jpg" title="Подкрашенная дорожка" />
<img alt="Подкрашенная дорожка" src="http://romeogolf.github.io/images/usb-polygon/02/circuit2.jpg" title="Подкрашенная дорожка" /></p>
<p>Защитил &laquo;земляную&raquo; сторону платы широким скотчем, правда, пришлось внахлест двумя полосками. Сунул в раствор хлорного железа, который у меня стоит уже довольно давно, больше года, и уже пару раз использовался, но работает до сих пор. Протравилось очень хорошо. Был один маленький недотрав, который я убрал скальпелем. Одна дорожка на самом краю вроде бы не рваная, но какая-то подозрительная, лучше ее укрепить. Но потом. </p>
<p>Просверлил отверстия, примерил элементы в них, особенно беспокоили толстоногие кнопки. Совместил с отверстиями платы рисунок второй стороны. Рисунок на бумаге немного шире платы, и после совпадения отверстий он был зафиксирован путем загиба полей. Перевел утюгом вторую сторону, &laquo;земляную&raquo; &mdash; практически сплошной полигон с пробелами под элементы (кнопки, светодиоды, джамперы и переключатели). Такие большие пространства тонером защищаются плохо, поэтому я решил помочь тонеру тем же лаком для ногтей, дополнительно подкрасил.</p>
<p>Стороны совпали достаточно хорошо, однако с учетом трехмиллиметровых площадок переходных отверстий. Миллиметровые переходы уже не получились бы. Впрочем, я специально выбрал такой вариант, чтобы не заморачиваться. Вообще-то тонкое совпадение слоев в домашних условиях реализуемо, но задачи такой не стояло.</p>
<p>Защитил протравленную сторону опять же скотчем. Допустил ошибку: отверстия надо было защитить дополнительно, капнуть лаком, например. Через отверстия под скотч затек раствор хлорного железа, испортил немножко одну дорожку.</p>
<p>Отремонтированные дорожки:</p>
<p><img alt="Отремонтированная дорожка" src="http://romeogolf.github.io/images/usb-polygon/02/circuit3.jpg" title="Отремонтированная дорожка" />
<img alt="Отремонтированная дорожка" src="http://romeogolf.github.io/images/usb-polygon/02/circuit4.jpg" title="Отремонтированная дорожка" /></p>
<p>Дальше лужение, ремонт двух дорожек, монтаж. Кварц засунул в кусок термоусадочной трубки для изоляции и подклеил к плате суперклеем, а выводы подключил проволочками, чтобы кварц не торчал, как памятник, возвышаясь над кнопками и светодиодами. Ножки джамперов паял, предварительно нацепив на них сами джамперы, для выравнивания. Не стал делать совсем уж хорошо, с пластмассовыми основаниями ножек: они есть, но мало и жалко. Подкрасил отлетевшие при лужении надписи. Еще добавил надписи, не предусмотренные при рисовании платы &mdash; как-то не подумал, что джамперы отключения кнопок тоже не мешало бы подписать.</p>
<h2 id="_5">Заключение</h2>
<p>Получился такой вид:</p>
<p><a href="http://romeogolf.github.io/images/usb-polygon/02/cpu.jpg" title="Вид со стороны контроллера"><img alt="Вид со стороны контроллера" src="http://romeogolf.github.io/images/usb-polygon/02/preview/cpu-small.jpg" title="Вид со стороны контроллера" /></a>
<a href="http://romeogolf.github.io/images/usb-polygon/02/led.jpg" title="Вид со стороны навесных элементов"><img alt="Вид со стороны навесных элементов" src="http://romeogolf.github.io/images/usb-polygon/02/preview/led-small.jpg" title="Вид со стороны навесных элементов" /></a></p>
<p>Итого общая стоимость платы &mdash; около 200 рублей. Если точно, то 198 за контроллер, пара рублей за резисторы 22 Ома. Не уверен, что сюда стоит плюсовать лист бумаги Lomond, который все равно уже был, разъем USB на плату, который был куплен (давно, рублей за 15), но предназначался для другого места, и хлорное железо, которое еще поработает. Все остальное или б/у, или досталось за спасибо.</p>
<p>Плата была замечена компьютером при первом же подключении, чем меня весьма порадовала. Попросила драйвер &mdash; с этим вопросы к фирме Atmel и ее программе FLIP, но это уже другая история.</p>
      <br/>	
      <footer>
          <div>
            <div>Теги:</div>
            <div class="taglist">
              <ul class="tags">
                <li><a href="http://romeogolf.github.io/tag/usb-polygon.html" class="tag">usb-polygon</a></li>
              </ul>
            </div>
          </div>
        <br/>
        <div class="comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_identifier = "usb-polygon-2.html";
            (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://romeogolf.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
          </script>
          <noscript>
            <div>Для чтения и написания комментариев требуется включить JavaScript.</div>
	  </noscript>
        </div>
      </footer>
    </article>
  </section>
    </div> <!-- content -->
    
  </div> <!-- layout -->

  <div class="footer">
    &copy; 2016 RomeoGolf


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72333148-1', 'auto');
  ga('send', 'pageview');

</script>

<!--    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72333148-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script> -->
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter35090040 = new Ya.Metrika({
                    id:35090040,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/35090040" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </div> <!-- footer -->

</body>
</html>