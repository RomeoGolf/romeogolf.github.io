<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USB-polygon-21: Окончание</title>
  <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="http://romeogolf.github.io/theme/css/styles.css" type="text/css" />
  <link rel="stylesheet" type="text/css"  href="http://romeogolf.github.io/theme/css/pygments.css"/>
  <link rel="shortcut icon" type="image/png" href="http://romeogolf.github.io/images/RG32.ico" />
  <script language="JavaScript" src="http://romeogolf.github.io/theme/js/protector.js"></script>
</head>
<body>
  <header class="main-header">
    <div>
      <img src="http://romeogolf.github.io/images/72.png" style="margin-left: 34px; margin-top: 30px;"> <a id="name" href=http://romeogolf.github.io id="home-link">RomeoGolf</a>
    </div>
  </header>
    <nav class="nav_base">
      <ul class="main-nav">
          <li class="active"><a href="http://romeogolf.github.io/category/blog.html">Блог</a></li>
          <li><a href="http://romeogolf.github.io/category/tvorchestvo.html">Творчество</a></li>


          <li>
            <a href="http://romeogolf.github.io/pages/triangulum-soft.html">Triangulum Soft</a>
          </li>
          <li>
            <a href="http://romeogolf.github.io/pages/o-saite.html">О сайте</a>
          </li>
      </ul>
    </nav>
  <div class="layout">

    <div class="sidebar">
      <div class="tagcloud">
        Теги:
        <ul class="tagcloud">
          <li class="tag-4">
            <a href="http://romeogolf.github.io/tag/batcmd.html">
              bat/cmd
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/linux.html">
              linux
                <span class="badge">3</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/markdown.html">
              markdown
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/pelican.html">
              pelican
                <span class="badge">6</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/rfquiz.html">
              rfquiz
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="http://romeogolf.github.io/tag/tar.html">
              tar
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/triangulum.html">
              triangulum
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-1">
            <a href="http://romeogolf.github.io/tag/usb-polygon.html">
              usb-polygon
                <span class="badge">22</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/windows.html">
              windows
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/nishchebrod.html">
              нищеброд
                <span class="badge">3</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/pokhodnoe.html">
              походное
                <span class="badge">3</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/raznoe.html">
              разное
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/remont.html">
              ремонт
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="http://romeogolf.github.io/tag/samodelki.html">
              самоделки
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-3">
            <a href="http://romeogolf.github.io/tag/svoimi-rukami.html">
              своими руками
                <span class="badge">2</span>
            </a>
          </li>
          <li class="tag-2">
            <a href="http://romeogolf.github.io/tag/stikhi.html">
              стихи
                <span class="badge">3</span>
            </a>
          </li>
        </ul>
      </div> <!-- tagcloud -->
    </div> <!-- sidebar -->

    <div class="content">
  <section class="main-section blog-section" id="blog-posts">
    <h4 class="date">Вт 12 Июнь 2018</h4>
    <article>
      <h1>USB-polygon-21: Окончание</h1>
      
      <div class="toc">
<ul>
<li><a href="#_1">Причесывание кода</a></li>
<li><a href="#_2">Результаты</a></li>
<li><a href="#_3">Выводы</a></li>
</ul>
</div>
<h2 id="_1">Причесывание кода</h2>
<p>Напоследок решил привести код подпроектов к какому-то единому стилю. По крайней мере, попытаться, хотя бы в некоторых моментах.</p>
<p>Для начала заменил табы на пробелы. Хотя я вполне согласен с мнением, что отступы &mdash; пустое место от начала строки до первых печатаемых символов &mdash; логично делать табами (для чего они и придуманы), а выравнивание (например, чтобы комментарии к строкам разной длины начинались с одной колонки) &mdash; пробелами. Однако, у такого решения есть свои минусы.</p>
<p>Во-первых, при сильно различающихся значениях табуляции (от 2 до 8) на разных машинах выравнивание пробелами все равно разъезжается безобразно. То есть, если на одной машине с табом в 2 пробела на строках с разным уровнем вложенности сделать выравнивание комментариев пробелами, то на другой машине с табом в 8 пробелов комментарии не будут выровнены. А время от времени приходится работать на разных машинах, в том числе, чужих, где правка настроек не приветствуется.</p>
<p>Во-вторых, ряд IDE и рекомендаций по стилю (например, Qt) требуют использования пробелов и неиспользования табов. При активном применении того же Qt Creator имеет смысл привыкать к стилю, используемому там по умолчанию.</p>
<p>В-третьих, сталкивался уже с чужим кодом, в связи с необходимостью его сопровождения или полного переписывания, где табы с пробелами были чудовищно перемешаны в произвольном порядке и последовательности. Это способствовало тому, что код было тяжело читать даже на той машине, на которой его писали, а при переносе в другую среду/редактор все расплывалось ужасно.</p>
<p>В общем, самый простой способ решения этих вопросов &mdash; использование пробелов вместо табов и замена табов на пробелы с последующим переформатированием отступов и выравнивания.</p>
<p>Далее отформатировал отступы, оформив соответствующую глубину вложенности для циклов, проверок условия и тому подобных блочных конструкций.</p>
<p>Затем навставлял переносов строки, ограничивая длину строк до 80 символов. Это удобно даже на современных широких экранах, чтобы не &laquo;бегать&raquo; глазами по всей ширине монитора. Кроме того, у меня редко используется окно среды или редактора во весь экран, а чаще занимает от силы половину по ширине. Опять же, периодически пользуюсь нетбуком в качестве рабочей станции. Короче, эта рекомендация во многих требованиях к стилю сохранилась до сих пор неспроста.</p>
<p>Еще исправил первые скобки функций так, чтобы открывающая код функции скобка была прижата к левому краю строки, а не заканчивала строку с названием функции, в отличие от скобок при условиях, циклах и прочих подобных блоках, где чаще рекомендуется &laquo;египетский&raquo; стиль. Это требование тоже присутствует во многих стилевых рекомендациях, и его выполнение повышает удобство работы в редакторах, в которых анализ текста синтаксический, а не семантический. Например, VIM ищет начало и конец функции по открывающей и закрывающей скобке именно в начале строки.</p>
<p>Ну, и поудалял закомментированный неиспользуемый код. Если придется закрытые строки все-таки использовать, можно откатить изменения в git, в конце концов, это одна из его функций.</p>
<h2 id="_2">Результаты</h2>
<p>Итак, в процессе работы над хобби-проектом были достигнуты следующие результаты:</p>
<ul>
<li>Создана простая цифровая электрическая принципиальная схема, впоследствии на практике проверена ее работоспособность;</li>
<li>Освоена (пусть на любительском уровне) среда KiCAD, бесплатная, кроссплатформенная и более чем достаточная для любительского проектирования;</li>
<li>Разведена в электронном виде и далее создана в натуре печатная плата;</li>
<li>Создано работоспособное устройство на базе микроконтроллера;</li>
<li>Освоен информационный обмен между микроконтроллерным устройством и компьютером по USB;</li>
<li>Разобраны тонкости организации памяти запоминающих устройств с файловой системой;</li>
<li>Освоена работа контроллера с некоторыми периферийными устройствами с использованием как портов в обычном режиме напрямую, так и SPI-порта;</li>
<li>Отлажена работа с экраном от мобильника, что позволяет использовать его в качестве устройства индикации с возможностями гораздо более широкими, чем, скажем, у светодиодной линейки</li>
<li>Отлажена работа с внешней флэш-памятью, что позволяет расширить память хранимых данных;</li>
<li>Отлажена работа с энкодером &mdash; очень удобным и довольно универсальным устройством ввода;</li>
<li>Получено расширяемое за счет программирования и подпайки к портам устройство, которое можно применить как для отладки алгоритмов, так и для реальной работы в каких-то самодельных приборах;</li>
<li>Цена окончательного варианта с учетом использования запчастей от неисправной техники около 200 р. на момент создания, из которых 198 р. &mdash; контроллер;</li>
<li>Требования ТЗ, сформулированного в первом опусе цикла, выполнены.</li>
</ul>
<p>Единственное, что не было сделано &mdash; не был освоен ассемблер AVR. Но настоятельной необходимости в нем не возникло ни разу. Во-первых, основная используемая библиотека &mdash; LUFA &mdash; написана на С. Во-вторых, с USB на голом ассемблере вообще работать не очень-то просто из-за обилия всякого рода структур, которые есть готовые на С, и из-за наличия готовых кусков кода на С, позволяющих не изобретать свои велосипеды. В-третьих, в данном учебном проекте не требовалось серьезной оптимизации ни по коду, ни по быстродействию. В общем, вполне достаточно возможностей языка С.</p>
<h2 id="_3">Выводы</h2>
<p>Если есть желание с нуля создать собственный проект на базе микроконтроллера, но нет опыта, мало инструмента и вообще страшновато, то бояться не надо: это несложно, недорого и довольно интересно.</p>
<p>Заготовка любительского проекта имеет нехилый потенциал за счет гибкости, обеспечиваемой программируемостью. Из одной и той же платы можно сделать довольно много чего, меняя всего лишь программу. Эх, добавить бы в схему еще и ПЛИС рублей тоже за 200&hellip;</p>
<p>Описываемое устройство уже было использовано в работе в качестве управляемого SPI-master для отладки разрабатываемого прибора, имеющего SPI-slave. Так что, хобби &ndash; не хобби, а может пригодиться не только в любительских целях.</p>
<p>Подобный проект для саморазвития полезнее ардуиностроения в разы. Он требует инженерного подхода к каждому шагу, начиная с подбора элементной базы и выбора программного обеспечения для проектирования и отладки. Он не привязывает к ограниченному набору лего-кирпичей (как аппаратных, так и программных), а приучает создавать устройство на совсем другом уровне. Такой подход позволяет исходить из решаемой задачи, подгоняя под результат размеры и форму устройства, используемое питание и все такое прочее. Кроме того, можно использовать для работы практически все, что есть под рукой, что при сборке ардуино-устройств тоже в принципе отчасти возможно, но несколько затруднительно. Опять же, можно существенно ужаться по бюджету, что может быть немаловажно для хобби-проектов, не только студенческих, но и в том возрасте, когда надо выбирать: купить игрушку себе или своему ребенку. Ардуино будет подороже, а игрушка ребенку &mdash; поважнее.</p>
<p>А то, что проект занял у меня больше года &mdash; это не показатель сложности, на самом деле. Просто работа над ним велась в очень свободное время &mdash; в те часы, которые не занимала работа, домашнее хозяйство, семья, друзья и активный отдых. А таких часов было за прошедшие несколько лет очень и очень немного. Если заниматься каждый вечер, да еще прихватывать выходные, то вполне можно было бы уложиться и в месяц &ndash; два.</p>
      <br/>	
      <footer>
          <div>
            <div>Теги:</div>
            <div class="taglist">
              <ul class="tags">
                <li><a href="http://romeogolf.github.io/tag/usb-polygon.html" class="tag">usb-polygon</a></li>
              </ul>
            </div>
          </div>
        <br/>
        <div class="comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_identifier = "usb-polygon-21.html";
            (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://romeogolf.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
          </script>
          <noscript>
            <div>Для чтения и написания комментариев требуется включить JavaScript.</div>
	  </noscript>
        </div>
      </footer>
    </article>
  </section>
    </div> <!-- content -->
    
  </div> <!-- layout -->

  <div class="footer">
    &copy; 2016 RomeoGolf


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72333148-1', 'auto');
  ga('send', 'pageview');

</script>

<!--    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72333148-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script> -->
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter35090040 = new Ya.Metrika({
                    id:35090040,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/35090040" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  </div> <!-- footer -->

</body>
</html>