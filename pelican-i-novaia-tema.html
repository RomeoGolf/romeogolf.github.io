<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="description" content="Title: Pelican и новая тема; Date: 2016-01-19; Summary: <p>Блог на Pelican - 4. Создание собственной темы для Pelican. Получение несложной заготовки для пояснения общих принципов. Попытка сделать своё с нуля позволит лучше понять чужое творчество, чтобы поправить стороннюю тему под свои нужды. А может, и допилить свою тему до совершенства. Подключение темы без ее установки.</p>">  
  <meta name="keywords" content="">  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pelican и новая тема</title>
  <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="./theme/css/styles.css" type="text/css" />
  <link rel="stylesheet" type="text/css"  href="./theme/css/pygments.css"/>
  <link rel="shortcut icon" type="image/png" href="./images/RG32.ico" />
</head>
<body>
  <header class="main-header">
    <div>
      <img src="./images/72.png" style="margin-left: 34px; margin-top: 30px;"> <a id="name" href=. id="home-link">RomeoGolf</a>
    </div>
  </header>
    <nav class="nav_base">
      <ul class="main-nav">
          <li class="active"><a href="./category/blog.html">Блог</a></li>
          <li><a href="./category/tvorchestvo.html">Творчество</a></li>


          <li>
            <a href="./pages/triangulum-soft.html">Triangulum Soft</a>
          </li>
          <li>
            <a href="./pages/o-saite.html">О сайте</a>
          </li>
      </ul>
    </nav>
  <div class="layout">

    <div class="sidebar">
      <div class="tagcloud">
        Теги:
        <ul class="tagcloud">
          <li class="tag-1">
            <a href="./tag/pelican.html">
              pelican
                <span class="badge">4</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="./tag/rfquiz.html">
              rfquiz
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="./tag/triangulum.html">
              triangulum
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="./tag/raznoe.html">
              разное
                <span class="badge">1</span>
            </a>
          </li>
          <li class="tag-4">
            <a href="./tag/stikhi.html">
              стихи
                <span class="badge">1</span>
            </a>
          </li>
        </ul>
      </div> <!-- tagcloud -->
    </div> <!-- sidebar -->

    <div class="content">
  <section class="main-section blog-section" id="blog-posts">
    <h3 class="date">Вт 19 Январь 2016</h3>
    <article>
      <h1>Pelican и новая тема</h1>
      
      <h2 id="_1">Начнем с нуля</h2>
<p>Тема notmyidea сама по себе выглядит неплохо и вполне допускает правку под свои нужды. Но поступим экстремальнее &mdash; сделаем всё с самого начала. В корне проекта сайта, в нашем случае &mdash; <code>D:\site\</code>, создаем папку themes, там делаем папку nanotheme, а в ней &mdash; папки static и templates. Почему nano? Во-первых, это модно, во-вторых, в этой теме будет предельный минимум, только для примера, чтобы хоть как-то работало.</p>
<p>В папке templates создадим base.html, текстовый файл в UTF-8. Непременный, обязательный базовый шаблон, который будет определять общую разметку для всех страниц, подчиняющихся нашей теме. Ну, и набросаем общий внешний вид:</p>
<p><code>:::html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;будет заголовок&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;header class="main-header"&gt;
      будет хедер
    &lt;/header&gt;
    &lt;nav&gt;
      Будет главное меню
    &lt;/nav&gt;
    &lt;div class="content"&gt;
      Будет контент
    &lt;/div&gt; 
    &lt;div class="footer"&gt;
      будет футер
    &lt;/div&gt; 
  &lt;/body&gt;
&lt;/html&gt;</code></p>
<p>Если этот файл посмотреть в браузере, то можно увидеть тупо четыре строчки:<br />
будет хедер<br />
Будет главное меню<br />
Будет контент<br />
будет футер  </p>
<p>А если запустить генерацию страниц сайта, то в результате мы вообще не увидим изменений. Оно и понятно &mdash; тема-то в настройках все еще подключена старая. Давайте переподключим. Найдем в pelicanconf.py строчку</p>
<p><code>:::python
THEME = 'notmyidea'</code>
и заменим ее на </p>
<p><code>:::python
THEME = 'themes/nanotheme'</code></p>
<p>Как вариант, можно не заменять, а поставить в начале исходной строки знак комментария #, а новую просто поставить чуть ниже (если хотите &mdash; чуть выше).</p>
<p>И вот теперь после генерации сайта мы увидим изменения. А именно: мы увидим эти же четыре строчки, что и в base.html, на любой сгенерированной странице сайта. Это не то, что нам бы хотелось, но именно то, что мы заказывали. Значит, надо научиться заказывать то, что мы хотим. </p>
<h2 id="_2">От простой разметки &mdash; к шаблону</h2>
<p>Для того, чтобы сделать из примитивной веб-странички примитивный шаблон для Pelican, надо использовать <a href="http://jinja.pocoo.org/docs/">jinja2</a> &mdash; движок сайтовых шаблонов для Python. Вставляя конструкции дзиндзя в текст разметки, мы даем генератору сайта понять, в каком месте шаблона мы хотим видеть некоторую информацию, и где ее взять. Строго говоря, эти конструкции будут работать в любом языке разметки, но, раз уж делаем сайт, нас интересует конкретно HTML.</p>
<p>Самыми употребимыми (глядя на код шаблонов нескольких скачанных тем) будут блоки и переменные. </p>
<p><code>:::html+jinja
&lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;h1&gt;{{ a_title }}&lt;/h1&gt;</code>
Первая конструкция позволяет в дочернем шаблоне создать именованный блок (с именем title), и содержимое этого блока будет подставлено на место, определенное в родительском шаблоне. Вторая конструкция вместо переменной языка Python вставит ее значение. А значение, в свою очередь, может быть, например, задано в файле конфигурации pelicanconf.py или определяться при помощи метаданных статьи или страницы.</p>
<p>Вообще-то, блоки являются подмножеством операторов, а переменные &mdash; подмножеством выражений:</p>
<ul>
<li>{% &hellip; %} &mdash; для операторов</li>
<li>{{ &hellip; }} &mdash; для выражений (печать вывода шаблона)</li>
<li>{# &hellip; #} &mdash; для комментариев, которые не включаются в вывод шаблона</li>
<li>#  &hellip; ## &mdash; для линейных выражений (в отличие от блочных, на одну строку)</li>
</ul>
<p>но подробный разбор синтаксиса jinja2 займет слишком много места и времени, чтобы заниматься им прямо здесь и прямо сейчас.</p>
<p>Давайте попробуем воткнуть парочку блоков и переменных. Что касается переменных &mdash; как минимум, мы имеем в настройках AUTHOR и SITENAME. Типовые названия некоторых блоков можно подсмотреть в других темах. Итак, правим базовый шаблон:</p>
<p>```
:::html+jinja
&lt;!DOCTYPE html&gt;
<html>
  <head>
    <meta charset="utf-8" />
    <title>{% block title %}{{SITENAME}}{% endblock %}</title>
    {% block head %}{% endblock %}
  </head>
  <body>
    <header class="main-header">
      <div>
        <a id="name" href={{ SITEURL }} id="home-link">{{ SITENAME }}</a>
      </div>
    </header>
    <nav>
      <ul class="main-nav">
        {% for cat, null in categories %}
          <li {% if cat == category %}class="active"{% endif %}>
        <a href="{{ SITEURL }}/{{ cat.url }}">{{ cat }}</a>
      </li>
        {% endfor %}</p>
<pre><code>    {% if DISPLAY_PAGES_ON_MENU %}
      {% for current_page in PAGES %}
        &lt;li {% if current_page == page %}class="active"{% endif %}&gt;
      &lt;a href="{{ SITEURL }}/{{ current_page.url }}"&gt;{{ current_page.title }}&lt;/a&gt;
    &lt;/li&gt;
      {% endfor %}
    {% endif %}
  &lt;/ul&gt;
&lt;/nav&gt;
&lt;div class="content"&gt;
  {% block main_section %}{% endblock %}
&lt;/div&gt; 
&lt;div class="footer"&gt;
  &amp;copy; {{AUTHOR}}
&lt;/div&gt;
</code></pre>
<p></body>
</html>
```</p>
<p>В результате base.html будет выглядеть уже так:</p>
<pre style="overflow:auto;">
{% block head %}{% endblock %}
{{ SITENAME }}

    {% for cat, null in categories %}
    {{ cat }}
    {% endfor %} {% if DISPLAY_PAGES_ON_MENU %} {% for current_page in PAGES %}
    {{ current_page.title }}
    {% endfor %} {% endif %} 

{% block main_section %}{% endblock %}
© {{AUTHOR}} 
</pre>

<p>а откомпилированные страницы сайта, соответственно, так:</p>
<pre>
Site

    Разное
    Рыба
    О сайте

© Me 
</pre>

<p>причем, ссылки &laquo;меню&raquo; кликабельны, что можно увидеть по изменению адреса в адресной строке браузера. Но все страницы выглядят совершенно одинаково. </p>
<p>В этом шаблоне мы:</p>
<ul>
<li>в теге <code>&lt;title&gt;</code> указали заголовок сайта, отображаемый в панели и вкладке браузера &mdash; взяли его из переменной SITENAME, указанной в  pelicanconf.py;</li>
<li>в теге <code>&lt;header&gt;</code> сделали заголовок сайта из этой же переменной;</li>
<li>в теге <code>&lt;nav&gt;</code> изобразили меню сайта:<ul>
<li>сперва при помощи оператроа <code>for</code> перечислили все категории, которые Python наковырял из метаданных наших статей, причем, обернули названия категорий в тег <code>&lt;a&gt;</code>, чтобы получились ссылки;</li>
<li>затем при помощи оператора <code>if</code> проверили переменную, заданную в файле конфигурации, которая разрешает указание в меню не только статей, но и страниц;</li>
<li>убедившись, что страницы тоже можно перечислить в меню, опять же при помощи <code>for</code> сделали список страниц, которых у нас пока одна &mdash; &laquo;О сайте&raquo;;</li>
</ul>
</li>
<li>в html-блоке <code>content</code> добавили jinja-блок <code>main_section</code> &mdash; для наследников;</li>
<li>в футере нарисовали значок копирайта с указанием автора, а автора взяли опять же из файла конфигурации, переменная AUTHOR.</li>
</ul>
<h2 id="_3">Добавляем шаблоны</h2>
<p>Но у нас нет шаблона для главной страницы сайта, которая index, а также для страницы со списком категорий, тегов и, собственно, самих статей, поэтому все страницы одинаковые &mdash; к ним применяется единственный шаблон. Сделаем index.html. В нем первым делом укажем, что он расширяет базовый. Потом в <code>main_section</code> перечислим имеющиеся статьи, запихав их в соответствующие html-теги, не забыв указать краткое содержание (article.summary). Должно получиться примерно так:</p>
<p><code>:::html+jinja2
{% extends 'base.html' %}
{% block main_section %}
  &lt;section class="main-section blog-section" id="blog-posts"&gt;
  {% for article in articles_page.object_list %}
    &lt;h3 class="date"&gt;{{article.locale_date}}&lt;/h3&gt;
      &lt;article&gt;
    &lt;h2&gt;
      &lt;a href="{{SITEURL}}/{{article.url}}"&gt;{{article.title}}
      &lt;/a&gt;
    &lt;/h2&gt;
    {{article.summary}}
    &lt;/article&gt;
  {% endfor %}
  &lt;/section&gt;
{% endblock %}</code></p>
<p>Шаблон для статей будет называться article.html, тоже расширяет базовый. В заголовке мы его попросим показать не имя сайта, а название статьи. В главной секции укажем дату статьи (сформированную в соответствии с локалью), заголовок статьи и сам текст (article.content). После текста статьи перечислим теги, если они есть, то есть, сперва проверим наличие, а потом нарисуем список, в котором каждый тег сделан ссылкой на список статей с таким тегом:</p>
<p>```
:::html+jinja2
{% extends 'base.html' %}
{% block title %}{{article.title}}{% endblock %}</p>
<p>{% block main_section %}
<section class="main-section blog-section" id="blog-posts">
  <h3 class="date">{{article.locale_date}}</h3>
  <article>
    <h2>{{article.title}}</a></h2>
    {{article.content}}
    <br/> <br />
      <footer>
        {% if article.tags %}
          <div>
      <div>Теги:</div>
          <div class="taglist">
            <ul class="tags">
              {% for tag in article.tags %}
                <li><a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{tag}}</a></li>
              {% endfor %}
            </ul>
          </div>
        </div>
        {% endif %}
      </footer>
  </article>
</section>
{% endblock %}
```</p>
<p>Для страниц, точнее, для пока единственной нашей страницы, нужен шаблон page.html, похожий на шаблон статей, только проще, без тегов:</p>
<p><code>:::html+jinja2
{% extends "base.html" %}
{% block title %}{{ page.title }}{% endblock %}
{% block main_section %}
  &lt;section class="main-section"&gt;
    &lt;h1 class="entry-title"&gt;{{ page.title }}&lt;/h1&gt;
    &lt;br /&gt;&lt;br /&gt;
    {{ page.content }}
  &lt;/section&gt;
{% endblock %}</code></p>
<p>Ну, и для выбора страниц по тегу нужен шаблон tag.html: </p>
<p><code>:::html+jinja2
{% extends 'base.html' %}
{% block title %}Статьи с тегом '{{tag}}' | {{ SITENAME }} {% endblock %}
{% block main_section %}
  &lt;section class="main-section blog-section" id="blog-posts"&gt;
    {% for article in articles %}
      &lt;h3 class="date"&gt;{{article.locale_date}}&lt;/h3&gt;
      &lt;article&gt;
        &lt;h2&gt;&lt;a href="{{SITEURL}}/{{article.url}}"&gt;{{article.title}}&lt;/a&gt;&lt;/h2&gt;
        {{article.summary}}
      &lt;/article&gt;
    {% endfor %}
  &lt;/section&gt;
{% endblock %}</code></p>
<p>Итак, <code>D:\site\themes\nanotheme\templates\</code> содержит пять файлов шаблонов. Вернемся в корень проекта сайта и запустим сборку. Теперь гиперссылки работают вменяемо. Ну, название сайта по-прежнему открывает содержимое корневой папки, но это нормально. Зато заголовок статьи ведет на страницу статьи, теги открывают страницу со списком статей с таким тегом, категории &mdash; на страницу со списком статей в данной категории.</p>
<p>Ой! А почему? Мы же не делали шаблон для categories.html, а он работает! Это как?
А так. <a href="http://docs.getpelican.com/en/3.6.3/themes.html#inheritance">Документация</a> рассказывает нам (правда, по-английски), что если какого-то из настоятельно необходимых шаблонов не окажется в папке templates, то вместо него будет использоваться соответствующий шаблон темы simple. И вообще, дескать, если вас устраивает HTML-структура шаблона этой умолчательной темы, то не надо писать собственных велосипедов. Тем более, что можно унаследоваться от шаблонов этой темы и чутка расширить их. Ну что ж, в отношении шаблона categories так и поступим.</p>
<h2 id="_4">Подключение стилей</h2>
<p>У нас теперь есть разметка разного рода страниц сайта. Но нет оформления, какая же это тема? Да никакая. Чтобы она стала хоть какая-нибудь, надо ей добавить стили. Значит, идем в папку <code>D:\site\themes\nanotheme\static\</code> и делаем там папку <code>css</code>, а в ней файл styles.css:</p>
<p>```
:::css</p>
<p>body {  /<em> установим серенький цвет фона и размер полей </em>/
    background-color: #CCC;
    margin: 25px;
}</p>
<p>.main-header, .content, .footer { 
    padding: 10px; /<em> внутриблочные отступы до границы </em>/
    margin: 20px; /<em> отступы между блоками страницы </em>/
    outline: solid 1px #000; /<em> черненькая тоненькая рамочка </em>/
    background-color: #FFF; /<em> и белый цвет фона </em>/
    min-width: 600px; /<em> позволим тянуться, </em>/
    max-width: 800px; /<em> но в определенных пределах </em>/
}</p>
<p>.main-header { 
    height: 200px; /<em> ограничим высоту </em>/
    background-color: #aaa; /<em> и подменим цвет </em>/
}</p>
<p>h1 a:hover {
    /<em> чтобы ссылка-заголовок при наведении не меняла цвет </em>/
    background-color: inherit
}</p>
<h1 id="name">name {</h1>
<pre><code>/* для текста названия сайта - размер, шрифт и рюшечки */
font-size: 350%; 
font-family: Arial;
text-decoration: none; /* Убираем подчёркивание */
color: #fff; /* Цвет текста белый */
</code></pre>
<p>}</p>
<p>.main-nav {
    height: 30px;
    margin-top: -50px;
}</p>
<p>.main-nav li {
    display: inline-block; /<em> Строчно-блочные элементы </em>/
    background-color: #551111; /<em> Цвет фона </em>/
    margin-right: 3px; /<em> Расстояние между пунктами меню </em>/
}</p>
<p>.main-nav a {
    color: #fff; /<em> Цвет ссылок </em>/
    display: block; /<em> Блочный элемент </em>/
    padding: 5px 15px; /<em> Поля вокруг текста </em>/
    text-decoration: none; /<em> Убираем подчёркивание </em>/
}</p>
<p>.main-nav li:hover {
    background-color: #881144; /<em> Цвет фона при наведении курсора мыши </em>/
}</p>
<p>.main-nav li.active {
    background-color: #881144; /<em> Цвет фона при наведении курсора мыши </em>/
}</p>
<p>.tags li {
    /<em> для списка тегов к статье, чтобы они были в одну строку </em>/
    display: inline-block; /<em> Строчно-блочные элементы </em>/
    margin-right: 3px; /<em> Расстояние между пунктами меню </em>/
}
```</p>
<p>Надо еще не забыть подключить эти стили в базовом шаблоне base.html, например, сразу после тега <code>&lt;title&gt;</code>:</p>
<p><code>:::html
    &lt;link rel="stylesheet" href="{{ SITEURL }}/theme/css/styles.css" type="text/css" /&gt;</code></p>
<p>Ни в коем случае не претендую на то, что создал прекрасный образец стиля. Цветовая гамма сомнительная, решение задать размер шрифта в процентах спорное. Однако такого CSS достаточно для того, чтобы показать: тема заработала так, как мы ожидали.</p>
<p>В нее еще многое можно напихать. Добавить шаблоны страниц для категорий и авторов, обозначить поведение, связанное с архивацией старых статей, включить ограничение количества статей на странице, дорисовать сайдбар (а может, и два, с обеих сторон), добавить плагины для облака тегов или карты сайта, нарисовать фон, логотип и иконку favicon, подобрать вменяемый набор цветов для оформления&hellip; В общем, хватает работы для дизайнера, верстальщика, контент-менеджера и всех остальных работников веб-студии, которых приходится представлять в единственном числе в собственном лице.</p>
<h2 id="_5">Всё еще впереди</h2>
<p>Чтобы сделать &laquo;идеальный&raquo; по своим требованиям шаблон (с точки зрения функциональности), надо хорошо представлять себе настройки Pelican и хотя бы в общих чертах иметь представление о jinja2.</p>
<p>Чтобы сделать качественную разметку шаблона (с точки зрения внешнего вида), надо иметь знания в области HTML, CSS, местами &mdash; JavaScript, и в общих чертах представлять, как это все работает в разных браузерах.</p>
<p>Чтобы сайт не вызывал отвращения у посетителей, надо быть хоть немного дизайнером, ну, или хотя бы обладать зачатками вкуса. К сожалению, этот параметр трудно оценить у себя самостоятельно&hellip;</p>
<p>Чтобы наполнять сайт контентом, надо уметь пользоваться языком разметки Markdown, но местами придется вставлять и HTML, при этом, надо знать язык статьи (русский, например, но хотелось бы иногда и английский) хотя бы на четверочку, владеть словом, а для привлекательного оформления уметь рисовать и фотографировать.</p>
<p>Как же много требований&hellip; Но не надо сдаваться! Тем более, никто не будет подходить к оценке блога с той же позиции, что и к оценке сайта профессионала-дизайнера или серезной промышленной компании. В конце концов, можно остановиться на простом минималистичном дизайне и наращивать только удобство пользования.</p>
      <br/>	
      <footer>
          <div>
            <div>Теги:</div>
            <div class="taglist">
              <ul class="tags">
                <li><a href="./tag/pelican.html" class="tag">pelican</a></li>
              </ul>
            </div>
          </div>
        <br/>
        <div class="comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_identifier = "pelican-i-novaia-tema.html";
            (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://romeogolf.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
          </script>
        </div>
      </footer>
    </article>
  </section>
    </div> <!-- content -->
    
  </div> <!-- layout -->

  <div class="footer">
    &copy; 2016 RomeoGolf


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72333148-1', 'auto');
  ga('send', 'pageview');

</script>

<!--    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72333148-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script> -->
  </div> <!-- footer -->

</body>
</html>